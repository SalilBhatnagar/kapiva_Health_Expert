{{#partial "head"}}
{{{ checkout.checkout_head }}}
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link href="https://cdn11.bigcommerce.com/shared/css/open_sans-5ec63c5b7015207649f715d5bf81d7d45e5a5496.css" rel="stylesheet" type="text/css">
<link href="https://cdn11.bigcommerce.com/shared/microapp/checkout/dist/checkout-dc6265ae.css" rel="stylesheet" type="text/css">
<style type="text/css"> 
    @font-face {
        font-family: "FoundersGrotesk";
        src: url("{{cdn 'assets/fonts/custom-fonts/Founders-Grotesk-Regular.woff2'}}") format("woff2"), 
        url("{{cdn 'assets/fonts/custom-fonts/Founders-Grotesk-Regular.woff'}}") format("woff"), 
        url("{{cdn 'assets/fonts/custom-fonts/Founders-Grotesk-Regular.otf'}}") format("opentype");
        font-weight: normal;
        font-style: normal;
        font-display: swap;

    }
    @font-face {
        font-family: "FoundersGrotesk-semibold";
        src: url("{{cdn 'assets/fonts/custom-fonts/Founders-Grotesk-Semibold.woff2'}}") format("woff2"), 
        url("{{cdn 'assets/fonts/custom-fonts/Founders-Grotesk-Semibold.woff'}}") format("woff"), 
        url("{{cdn 'assets/fonts/custom-fonts/Founders-Grotesk-Semibold.otf'}}") format("opentype");
        font-weight: 500;
        font-style: normal;
        font-display: swap;

    }
    @font-face {
        font-family: "RecoletaAlt-SemiBold";
        src: url("{{cdn 'assets/fonts/custom-fonts/Recoleta-Alt-SemiBold.woff2'}}") format("woff2"), 
        url("{{cdn 'assets/fonts/custom-fonts/Recoleta-Alt-SemiBold.woff'}}") format("woff"), 
        url("{{cdn 'assets/fonts/custom-fonts/Recoleta-Alt-SemiBold.otf'}}") format("opentype");
        font-style: normal;
        font-weight: 400; 
        font-display: swap;     
    }
</style>
{{{ stylesheet '/assets/css/optimized-checkout.css' }}}
{{ getFontsCollection }}
<!-- Google Analytics Snippet -->
<!-- Global site tag (gtag.js) - Google Analytics -->

<script type="text/javascript">
   window.language = {{{langJson 'optimized_checkout'}}};
</script>
{{{head.scripts}}}
{{/partial}}
{{#partial "page"}}
<header class="checkoutHeader optimizedCheckout-header">
   <div class="checkoutHeader-content">
      <h1 class="is-srOnly">{{lang 'checkout.title'}}</h1>
      <h2 class="checkoutHeader-heading">
         <a class="checkoutHeader-link" href="{{urls.home}}">
         <img alt="{{settings.store_logo.title}}" class="checkoutHeader-logo" id="logoImage" src="https://cdn11.bigcommerce.com/s-q0ghktat3g/product_images/subtract_1617795361__77099.original_1625657373.png"/>
         </a>
      </h2>
   </div>
</header>
{{{ checkout.order_confirmation_content }}}
<div id="checkout-app" class="checkout-custom-app">
   <div class="layout optimizedCheckout-contentPrimary">
      <div class="layout-main">
         <div class="orderConfirmation">
            <h1 class="optimizedCheckout-headingPrimary" data-test="order-confirmation-heading"></h1>
            <section class="orderConfirmation-section">
               <p data-test="order-confirmation-order-number-text" class="order-confirmation-order-number-text"><span>Your order number is <strong></strong></span></p>
               <p data-test="order-confirmation-order-status-text"><span>You will receive an email with your purchase details shortly. Please also check your Spam folder. In case of questions or concerns regarding the same, email us at <a target="_top" href="mailto:info@kapiva.in">info@kapiva.in</a> or call us at <a href="tel:8080177000">+91-8080 177 000</a>.</span></p>
            </section>
            <div class="continueButtonContainer">
               <a href="{{urls.home}}" target="_top">
               <button class="button button--tertiary optimizedCheckout-buttonSecondary" type="button">Continue Shopping »</button>
               </a>
            </div>
         </div>
      </div>
      <aside class="layout-cart">
         <article class="cart optimizedCheckout-orderSummary" data-test="cart">
            <header class="cart-header">
               <h3 class="cart-title optimizedCheckout-headingSecondary">Order Summary</h3>
               <a class="cart-header-link" id="cart-print-link" onclick="window.print()">
                  <div class="icon">
                     <svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"></path>
                     </svg>
                  </div>
                  Print
               </a>
            </header>
            <section class="cart-section optimizedCheckout-orderSummary-cartSection">
               <h3 class="cart-section-heading optimizedCheckout-contentPrimary" data-test="cart-count-total"></h3>
               <ul aria-live="polite" class="productList"></ul>
            </section>
            <section class="cart-section optimizedCheckout-orderSummary-cartSection">
               <div data-test="cart-subtotal">
                  <div aria-live="polite" class="cart-priceItem optimizedCheckout-contentPrimary cart-priceItem--subtotal"><span class="cart-priceItem-label"><span data-test="cart-price-label">Subtotal  </span></span><span class="cart-priceItem-value"><span data-test="cart-price-value"></span></span>
                  </div>
               </div>
               <!--<div data-test="cart-coupon"><div aria-live="polite" class="cart-priceItem optimizedCheckout-contentPrimary"><span class="cart-priceItem-label"><span data-test="cart-price-label">10% off each item</span></span><span class="cart-priceItem-value"><span data-test="cart-price-value">-₹333</span></span><span class="cart-priceItem-postFix optimizedCheckout-contentSecondary" data-test="cart-price-code">Test10</span></div></div>-->
               <div data-test="cart-shipping">
                  <div aria-live="polite" class="cart-priceItem optimizedCheckout-contentPrimary cart-priceItem--shipping-cost"><span class="cart-priceItem-label"><span data-test="cart-price-label">Shipping  </span></span><span class="cart-priceItem-value"><span data-test="cart-price-value">Free</span></span>
                  </div>
               </div>
               <div data-test="cart-taxes">
                  <div aria-live="polite" class="cart-priceItem optimizedCheckout-contentPrimary cart-priceItem--subtotal-tax"><span class="cart-priceItem-label"><span data-test="cart-price-label">Tax  </span></span><span class="cart-priceItem-value"><span data-test="cart-price-value">₹0</span></span>
                  </div>
               </div>
            </section>
            <section class="cart-section optimizedCheckout-orderSummary-cartSection">
               <div data-test="cart-total">
                  <div aria-live="polite" class="cart-priceItem optimizedCheckout-contentPrimary cart-priceItem--total"><span class="cart-priceItem-label"><span data-test="cart-price-label">Total (INR)  </span></span><span class="cart-priceItem-value"><span data-test="cart-price-value"></span></span>
                  </div>
               </div>
            </section>
         </article>
      </aside>
   </div>
</div>
<div class="CatSlider-Wrap browsing_history">
  <div class="featured-section">
    <h2 class="page-heading text-center">Inspired by Your Browsing history</h2>
  </div>
  <div class="product-space browsing_history">
  </div>
</div>
{{{ footer.scripts }}}
{{/partial}}
{{> layout/empty}}
<link preload rel="stylesheet" href="{{cdn 'assets/scss/custom/slick.min.css'}}" crossorigin="anonymous"
  referrerpolicy="no-referrer" />

<link preload rel="stylesheet" href="{{cdn 'assets/scss/custom/owl.carousel.min.css'}}">
<link preload rel="stylesheet" href="{{cdn 'assets/scss/custom/owl.theme.default.min.css'}}">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script defer="defer" src="{{cdn 'assets/js/owl.carousel.min.js'}}"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://vuex.vue.ai/embed-code/embed_code.js" async="async" defer="defer" data-msd-client-id="7044932c-da92-4449-870a-776a73e3eb20" data-msd-region="ap-southeast-1"></script>
<input type="hidden" value="{{customer.id}}" class="customer_id">
<script>
    function getCookie(e) {
       for (var t = e + "=", o = decodeURIComponent(document.cookie).split(";"), n = 0; n < o.length; n++) {
           for (var i = o[n];
               " " == i.charAt(0);) i = i.substring(1);
           if (0 == i.indexOf(t)) return i.substring(t.length, i.length)
       }
       return ""
    }
   
   $(document).ready(function () {
       var cat_id = cat_name = p_id = p_name = p_price = p_quantity =  '';
     var discounted_amount = '';
     var Coupon_Code_Applied = '';
     var Coupon_Code_Applied_Name = '';
     var Coupon_Code_Applied_Amount = '';
     var Purchase_Amount = '';
     var Phone_Number = '';
     var Email_Address = '';
     var First_Name = '';
     var Last_Name = '';
     var Order_Address_City = Order_Address_Pin = Payment_Status = '';
     var payment_method = [];
        var order_data = getCookie('checkout_order');
       
        var order_id = '';
        if(order_data){
            var order_data = JSON.parse(order_data);
            var order_id = (order_data.order_id && order_data.order_id > 0 ) ? order_data.order_id : order_data.id;
           
        }
         fetch('/api/storefront/order/'+order_id, {credentials: 'include'})
         .then(function(response) {
             return response.json();
         })
         .then(function(orderData) {
             if( orderData.status == 404){
                 window.location.href = '/cart.php';
             }
             order_id  = orderData['orderId'];
            user_email = orderData['billingAddress']['email'];
            total_price = orderData['baseAmount'];
            var products = [];
            let transaction = {
              'event': 'purchase',
              'transactionId': orderData['orderId'],
              'transactionTotal': orderData['orderAmount'],
              'transactionTax': orderData['taxTotal'],
              'transactionShipping': orderData['shippingCostTotal'],
              'transactionProducts' :[]
             };

             for (var i = 0; i < orderData['lineItems']['physicalItems'].length; i++) {
                var obj = {
                    
                   "orderedItemId" : orderData['lineItems']['physicalItems'][i]['productId'],
                    "orderedItemSku" : orderData['lineItems']['physicalItems'][i]['sku'],
                    "orderedItemPrice" : orderData['lineItems']['physicalItems'][i]['salePrice'],
                    "orderedItemQuantity": orderData['lineItems']['physicalItems'][i]['quantity'],
                    "orderedItemGTIN": "None"
                };
                products.push(obj);
                // for transactions
                let lineItem ={
                  'id': orderData['lineItems']['physicalItems'][i]['productId'],
                  'sku': orderData['lineItems']['physicalItems'][i]['sku'],
                  'name': orderData['lineItems']['physicalItems'][i]['name'],
                  'price':orderData['lineItems']['physicalItems'][i]['salePrice'],
                  'quantity': orderData['lineItems']['physicalItems'][i]['quantity']
                }
                  transaction.transactionProducts.push(lineItem)
             }

            var selector = localStorage.getItem('oid');
            if(selector != order_id){
                 localStorage.removeItem('oid');
                localStorage.setItem('oid', order_id);
             window.dataLayer = window.dataLayer || [];
            dataLayer.push({orderedItems:products});
            dataLayer.push(transaction);
            }
              $('.optimizedCheckout-headingPrimary').text('Thank you for shopping with us, '+orderData.billingAddress.firstName+'!');
              $('.order-confirmation-order-number-text span strong').text(orderData.orderId);
              $('.cart-priceItem--total .cart-priceItem-value span').text('₹'+orderData.orderAmount);
              $('.cart-priceItem--subtotal .cart-priceItem-value span').text('₹'+orderData.baseAmount);
              $('.cart-priceItem--subtotal-tax .cart-priceItem-value span').text('₹'+orderData.taxTotal);
              $('.cart-priceItem--shipping-cost .cart-priceItem-value span').text((orderData.shippingCostTotal > 0) ? '₹'+orderData.shippingCostTotal : "Free");
            
             order_total = orderData.orderAmount;
             
             
             var total_items = orderData.lineItems.physicalItems.length;
             $('.cart-section-heading').text(total_items + (( total_items > 1) ? ' Items' :  ' Item'));
             orderData.lineItems.physicalItems.forEach(function(item, index) {
                 $('.optimizedCheckout-orderSummary-cartSection ul.productList').append('<li class="productList-item is-visible">'+
                             '<div class="product" data-test="cart-item">'+
                                 '<figure class="product-column product-figure"><img alt="'+item.name+'" data-test="cart-item-image" src="'+item.imageUrl+'"></figure>'+
                                 '<div class="product-column product-body">'+
                                     '<h5 class="product-title optimizedCheckout-contentPrimary" data-test="cart-item-product-title">'+item.quantity+' x '+item.name+'</h5>'+
                                     '<ul class="product-options optimizedCheckout-contentSecondary" data-test="cart-item-product-options"></ul>'+
                                 '</div>'+
                                 '<div class="product-column product-actions">'+
                                     '<div class="product-price optimizedCheckout-contentPrimary" data-test="cart-item-product-price">₹'+item.salePrice+'</div>'+
                                 '</div>'+
                             '</div>'+
                         '</li>');
             });
          //webengage code start
           $.ajax
          ({ 
            type: "POST",
            url: "https://bg-sync-api-dev.kapiva.in/api/getorderdetails.php",
            async: false,
            headers: { oid: order_id },
            success: function (html) {
              var paymentMethod = JSON.parse(html);
              payment_method.push(paymentMethod.method);
            },
          });
         
        if (orderData['coupons'].length > 0) {
           Coupon_Code_Applied = "true";
           Coupon_Code_Applied_Name = orderData['coupons'][0]['code'];
           Coupon_Code_Applied_Amount = orderData['coupons'][0]['discountedAmount'];
        }else{
          Coupon_Code_Applied = "false";
          Coupon_Code_Applied_Name = "NULL";
          Coupon_Code_Applied_Amount = 0;
        }
        var ids = ''; 
         Purchase_Amount = orderData['orderAmount'];
         Phone_Number = Number(orderData['billingAddress']['phone']);
        Email_Address = orderData['billingAddress']['email'];
        First_Name = orderData['billingAddress']['firstName'];
        Last_Name = orderData['billingAddress']['lastName'];
        Order_Address_City = orderData['billingAddress']['city'];
        Order_Address_Pin = orderData['billingAddress']['postalCode'];
        Payment_Status = orderData['status'];
        for (var i = 0; i < orderData['lineItems']['physicalItems'].length; i++) {

          var alldata = orderData['lineItems']['physicalItems'][i];
          var Product_Id = alldata['productId'];
          var Product_Name = alldata['name'];
          var Product_Price = alldata['salePrice'];
          var Product_Quantity = alldata['quantity'];
          if(p_id == '' && p_name == '' && p_price == '' && p_quantity == ''){
            p_id = Product_Id.toString();
            p_name = Product_Name;
            p_price = Product_Price.toString();
            p_quantity = Product_Quantity.toString();
          }else{
            p_id = p_id+','+Product_Id;
            p_name = p_name+','+Product_Name;
            p_price = p_price+','+Product_Price;
            p_quantity = p_quantity+','+Product_Quantity;
          }
         if(ids == ''){
                  ids = Product_Id;
                }else{
                  ids = ids+','+Product_Id;
                }
              }
              var query = `query ExtendedProductsById {
          site {
            products(entityIds: [`+ ids + `]) {
              edges {
                node {
                  id
                  entityId
                  name
                  inventory{
                  isInStock
                  aggregated{
                    availableToSell
                    warningLevel
                  }
                }
                  categories
                  {
                  edges
                    {
                      node
                      {
                        id
                        name
                        
                      }
                    } 
                  }
                  
                  prices (includeTax:true){
                    price {
                      ...MoneyFields
                    }
                    priceRange {
                      min {
                        ...MoneyFields
                      }
                      max {
                        ...MoneyFields
                      }
                    }
                    salePrice {
                      ...MoneyFields
                    }
                    retailPrice {
                      ...MoneyFields
                    }
                    saved {
                      ...MoneyFields
                    }
                    bulkPricing {
                      minimumQuantity
                      maximumQuantity
                      ... on BulkPricingFixedPriceDiscount {
                        price
                      }
                      ... on BulkPricingPercentageDiscount {
                        percentOff
                      }
                      ... on BulkPricingRelativePriceDiscount {
                        priceAdjustment
                      }
                    }
                  }
                }
              }
            }
          }
        }
        fragment MoneyFields on Money {
              value
              currencyCode
            }`;
          $.ajax({
            url: "/graphql", 
            contentType: "application/json",
            type: 'POST',
            async: false,
            headers: {
              'Authorization': 'Bearer {{ settings.storefront_api.token }}'
            },
            data: JSON.stringify({ query: query }),
            success: function (productsData) {
              var getdata = productsData.data.site.products.edges;
                      $(getdata).each(function(index, value){ 
                        var alldata = value.node;
                  if (alldata) {
                 
                 if(alldata.prices.saved != null){
                   if(discounted_amount == ''){
                   discounted_amount = alldata.prices.saved.value;
                   discounted_amount = discounted_amount.toString();
                  }
                   else{ discounted_amount = discounted_amount+','+alldata.prices.saved.value;}
                  
                 }else{
                  if(discounted_amount == ''){
                    discounted_amount = 0;
                    discounted_amount = discounted_amount.toString();
                              }else{
                                discounted_amount = discounted_amount+','+0;
                              }
                }
                var category = alldata.categories.edges;
                var category_id = '';
                var category_name = '';
                $(category).each(function (index, value) {
                               if(category_id == '' && category_name == ''){
                                   var cat_id = value.node.id;
                                   var splited_url = atob(cat_id);
                                   var categoryid = splited_url.split("Category:");
                                    category_id = categoryid[1];
                                   category_name = value.node.name
                                 }
                                  else{
                                    var splited_url = atob(value.node.id);
                                    var categoryid= splited_url.split("Category:");
                                     var catid = categoryid[1];
                                      category_id = category_id+','+catid;
                                      category_name = category_name+','+value.node.name;
                                }

                            })
                            if(cat_id == '' && cat_name == ''){
                              cat_id = category_id;
                              cat_name = category_name;
                            }else{
                              cat_id = cat_id+','+category_id;
                              cat_name = cat_name+','+category_name;
                            }
              
              }
            });
            },
          });
          webengage.track("Payment success", {
                  "Product_Id": p_id,
                  "Product_Name": p_name,
                  "Product_Price": p_price,
                  "Discounted_amount": discounted_amount,
                  "Product_Quantity": p_quantity,
                  "Purchase_Amount": Purchase_Amount,
                  "Phone_Number": Phone_Number,
                  "Email_Address": Email_Address,
                  "First_Name": First_Name,
                  "Last_Name": Last_Name,
                  "Cashback_Earned_Amount": Coupon_Code_Applied_Amount,
                  "Payment_Mode": payment_method[0],
                  "Payment_Status": Payment_Status,
                  "Coupon_Code_Applied": Coupon_Code_Applied,
                  "Coupon_Code_Applied_Name": Coupon_Code_Applied_Name,
                  "Coupon_Code_Applied_Amount": Coupon_Code_Applied_Amount


                });

                webengage.track("Delivery_Details", {
                  "Product_Id": p_id,
                  "Product_Name": p_name,
                  "Category_ID": cat_id,
                  "Category_Name": cat_name,
                  "Price": p_price,
                  "Quantity": p_quantity,
                  "Cart_Amount": Purchase_Amount,
                  "Purchase_Amount": Purchase_Amount,
                  "Order_Address_City": Order_Address_City,
                  "Order_Address_Pin": Order_Address_Pin,
                  "Coupon_Code_Applied": Coupon_Code_Applied,
                  "Coupon_Code_Applied_Name": Coupon_Code_Applied_Name,
                  "Coupon_Code_Applied_Amount": Coupon_Code_Applied_Amount

                });
      });
     
     
  });
  let MADid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c == 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
    let u_id = $(".customer_id").val();
    var platform = '';
    if (screen.width < 1024) {
      platform = 'mobile';
    } else {
      platform = 'desktop';
    }
    axios.get('https://bg-sync-api-dev.kapiva.in/api/vueDataHomePage.php', {
        params: {
          mad_uuid: MADid,
          user_id: u_id,
          page_name: 'OC',
          platform: platform,
          product: ''
        },
        async: false,
      })
      .then(function (response) {
        var len=response.data.data.length;
        
        var sectionValue = ["browsing_history"];
        var sectionKey = ["Inspired By Your Browsing History-1"]
        var objSection = {};
        for (var i = 0; i < 4; i++) {
          objSection[sectionKey[i]] = sectionValue[i];
        }
        for (let i = 0; i < len; i++) {
          var htmlData = response.data.data[i].data;
        
          var html = '';

          html += '<ul class="productCarousel owl-carousel owl-theme">'
          var variant_sku = '';

          htmlData.forEach(function (value, index) {
            if(index < 9){
            var discount_price = value.price - value.discounted_price;
            var discount = (discount_price * 100) / value.price;
            var discount_round = discount.toPrecision(2);
            var total = discount_round + "% OFF";
            html += '<li class="productCarousel-slide" data-position="0">'
            html += '<article class="card" data-product-id="undefined">'
            html += '<figure class="card-figure">'
            html += '<a href="' + value.link +
              '" class="card-figure__link kapiva-curve small overflow-hidden">'
            html += '<div class="card-img-container"><img src="' + value.image_link + '" data-src="' + value
              .image_link + '" data-sizes="auto" alt="' + value.title + '" title="' + value.title +
              '" class="card-image kapiva-curve big loaded shown lazyautosizes ls-is-cached lazyloaded" sizes="426px"></div>'
            html += '<div class="tag-section">'
            html += '<span class="groupBox">'
            html += '<span class="saleSavingTag">' + total + '</span>'
            html += '</span>'
            html += '</div>'
            html += '</a>'
            html += '</figure>'
            html += '<div class="card-body">'
            html += '<h3 class="card-title"><a href="' + value.link + '">' + value.title + '</a></h3>'
            html += '<div class="card-text" data-test-info-type="price">'
            html +=
              '<div class="price-section price-section--withoutTax rrp-price--withoutTax"><span data-page-builder-key="pdp-retail-price-label" data-default-translation="MSRP:"></span><span data-product-rrp-price-without-tax="" class="price price--rrp">₹' +
              value.price + '</span></div>'
            html +=
              '<div class="price-section price-section--withoutTax non-sale-price--withoutTax"><span data-page-builder-key="pdp-non-sale-price-label" data-default-translation="Was:"></span><span data-product-non-sale-price-without-tax="" class="price price--non-sale">₹' +
              value.price + '</span></div>'
            html +=
              '<div class="price-section price-section--withoutTax"><span class="price-label" style="display: none;"></span><span class="price-now-label" data-page-builder-key="pdp-sale-price-label" data-default-translation="Now:"></span><span data-product-price-without-tax="" class="price price--withoutTax price--actual">₹' +
              value.discounted_price + '</span></div>'
            html += '</div>'
            html += '<div class="Prod-AddToCart" data-vue-analytics-click-event="set">'
            html +=
              '<a href="javascript:void(0);" data-event-type="product-click" data-button-type="add-cart" class="button button--small buy-now tranding_buy_now_add_to_cart" data-product-id="' +
              value.pid + '">Buy Now</a>'
            html += '<div class="ProductAddtocartWrap Prod-AddToCart-add cardwishlist add-cart">'
            html += '<div class="form ProductWhislist" data-wishlist-add="">'
            html += '<div class="button button-wishlist">'
            html += '<span class="heart-icon">'
            html +=
              '<a href="javascript:void(0);" data-event-type="product-click" data-button-type="add-cart" id="trand-card-addtocart-button" class="bag-icon trand-card-addtocart-button tranding_' +
              value.pid + '" data-product-id="' + value.pid +
              '"> <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 380 367" width="38" height="38"><path class="" d="M332.66,104.44C330.5,90.93,320,81.85,306.48,81.85H104.77l-.06-.72L103.5,68.76c-.24-2.35-.46-4.69-.68-7-.59-6.14-1.19-12.48-2-18.74-1-8-7.27-13.81-14.87-13.89C75,29,65,29,55.15,29.09c-7.73.1-14.15,6.45-14.94,14.77a17.23,17.23,0,0,0,4.14,13.27,15.64,15.64,0,0,0,11.49,5.18c4.74.08,9.36.06,14.25,0h.75l.36,3.58c.66,6.61,1.3,13.08,1.93,19.55l3.3,34.29q1.72,17.92,3.46,35.85,1.14,11.73,2.3,23.44c1.57,15.87,3.2,32.29,4.65,48.43,1.9,21.07,16.94,35.79,36.58,35.79H273.75c17.59,0,31.85-12.3,35.5-30.59,8.18-41.06,15.72-79.24,23-116.72A34.09,34.09,0,0,0,332.66,104.44ZM127,229.77c-2.82,0-4.32-.73-4.71-4.68q-2.3-22.82-4.49-45.65l-6.25-63.94c31.93,0,62.72.24,92.55.45,29.68.21,60.3.42,92.09.45-3.64,18.38-7.53,36.85-11.29,54.71-3.72,17.64-7.56,35.87-11.17,54-.87,4.39-2.26,4.61-4.65,4.61C219,229.79,177.13,229.79,127,229.77Z"></path><path class="" d="M262.44,274.84a28.24,28.24,0,0,0-20.3,7.85A29.85,29.85,0,0,0,232.7,304c-.19,16,12.85,29.19,29.06,29.48h.52c15.67,0,28.61-12.8,29-28.78C291.62,288.45,279,275.33,262.44,274.84Z"></path><path class="" d="M140.7,274.84h-.24a29.34,29.34,0,0,0,0,58.67h.21A28.89,28.89,0,0,0,161,325.14a29.24,29.24,0,0,0,.18-41.76A28.77,28.77,0,0,0,140.7,274.84Z"></path></svg><div id="pro-count"></div>'
            html += '</a>'
            html += '</span>'
            html += '</div>'
            html += '</div>'
            html += '</div>'
            html += '</div>'
            html += '</div>'
            html += '</article>'
            html += '</li>'
            }
          });
          html += '</ul>'
          if (htmlData.length > 0 && objSection[response.data.data[i].module_name]) {
            document.querySelectorAll('.CatSlider-Wrap.' + objSection[response.data.data[i].module_name])[0].style
              .display = 'block';
            var new_section = document.querySelectorAll('.product-space.' + objSection[response.data.data[i]
              .module_name]);
            new_section[0].innerHTML = html;

            $('.product-space.' + objSection[response.data.data[i].module_name] + ' .owl-carousel').owlCarousel({
              items: 3,
              loop: true,
              responsiveClass: true,
              responsive: {
                0: {
                  items: 1
                },
                550: {
                  items: 2
                },
                960: {
                  items: 3
                }
              }
            });
          } else if (objSection[response.data.data[i].module_name]) {
            document.querySelectorAll('.CatSlider-Wrap.' + objSection[response.data.data[i].module_name])[0].style
              .display = 'none';
          }
        }

      })
      .catch(function (error) {
        console.log(error);
      })
      .then(function () {
        // always executed
      });
      CountAddToCart()
    function CountAddToCart() {
      var setinterval = setInterval(function () {
        var len = document.getElementsByClassName("bag-icon").length;
        if (len > 0) {
          clearInterval(setinterval);
          fetch('/api/storefront/carts?include=', {
            'credentials': 'include',
            'headers': {
              'Accept': 'application/json',
              'Content-Type': 'application/json'
            }
          }).then(function (response) {
            response.json().then(function (data) {
              if (data.length != 0) {
                var getid = data[0]['lineItems']['physicalItems'];

                getid.forEach(function (value, key) {
                  var pid = value.productId;

                  var qty = value.quantity;
                  var bagIcon = document.getElementsByClassName("bag-icon");
                  document.querySelectorAll('.bag-icon').forEach(item => {
                    //  bagIcon.forEach(function (value,key) {

                    var p_id = item.getAttribute("data-product-id");
                    if (p_id != undefined && p_id == pid && qty != null) {
                      let el = item;
                      $(this).find("#pro-count").text(qty);

                      item.parentElement.querySelectorAll('#pro-count')[0].textContent = qty;
                      item.parentElement.parentElement.parentElement.parentElement.classList.add("fill-Prod-add-to-cart");
                      item.parentElement.querySelectorAll('#pro-count')[0].classList.add("fill-count");
                    }

                  })
                })
              }
            })
          })
        }
      }, 200)
    }
  var interval = setInterval(function () {
         var len3 = document.querySelectorAll(".browsing_history .productCarousel").length; 
     
         //var len3 = document.querySelectorAll(".Prod-AddToCart .buy-now.tranding_buy_now_add_to_cart").length;
       
         if (len3 > 0) {
        
          clearInterval(interval);
          //buynow trending products
          document.querySelectorAll('.Prod-AddToCart .buy-now.tranding_buy_now_add_to_cart').forEach(item => {
            item.addEventListener('click', function (event) {
               event.preventDefault();
            
               var discount_pr = '';
               
               if(this.parentElement.parentElement.parentElement.querySelectorAll(".card-figure .card-figure__link .tag-section .groupBox .saleSavingTag").length > 0){
              var discount = this.parentElement.parentElement.parentElement.querySelectorAll(".card-figure .card-figure__link .tag-section .groupBox .saleSavingTag")[0].textContent;
               discount_pr = discount.trim();
               }
              var pro_id = this.getAttribute("data-product-id");
              if (this.classList.contains('disabled') == false) {
                var cart_quantity = localStorage.getItem('cart-quantity');
               

                axios({
                  url: '/remote/v1/cart/add',
                  method: 'post',
                  dataType: 'json',
                  data: {
                    action: 'add',
                    "product_id": pro_id,
                    "qty[]": 1
                  }
                }).then((result) => {
                  if (result.data.data.cart_item) {
                    buyNow(pro_id, discount_pr)
                    window.location.href = '/checkout';
                  }
                });
              }
            });
          });
          //end buynow trending products

          //addtocart trending product
          document.querySelectorAll('#trand-card-addtocart-button').forEach(item => {
            item.addEventListener('click', function (value, index) {

              value.preventDefault();
              var pro_id = this.getAttribute("data-product-id");
              var discount = this.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.querySelectorAll(".card-figure .card-figure__link .tag-section .groupBox .saleSavingTag")[0].textContent;
              let discount_pr = discount.trim();
              var cart_quantity = localStorage.getItem('cart-quantity');

              axios({
                url: '/remote/v1/cart/add',
                method: 'post',
                dataType: 'json',
                data: {
                  action: 'add',
                  "product_id": pro_id,
                  "qty[]": 1
                }
              }).then((result) => {
                if (result.data.data.cart_item) {
                 
                }
                fetch('/api/storefront/carts?include=', {
                  'credentials': 'include',
                  'headers': {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                  }
                }).then(function (response) {
                  response.json().then(function (data) {
                    if (data.length != 0) {
                      var getid = data[0]['lineItems']['physicalItems'];
                      getid.forEach(function (value, key) {
                        var pid = value.productId;

                        var qty = value.quantity;

                        if (pro_id != undefined && pro_id == pid) {
                          let tranding = document.getElementsByClassName("tranding_" + pid)[0];
                          tranding.parentElement.querySelectorAll('#pro-count')[0].textContent = qty;
                          tranding.parentElement.parentElement.parentElement.parentElement.classList.add("fill-Prod-add-to-cart");
                          tranding.parentElement.querySelectorAll('#pro-count')[0].classList.add("fill-count");
                          
                        }
                       
                      });
                      addToCart(pro_id, discount_pr)
                    }
                  });
                });
               
              });
            });
          });
          //end addtocart trending product
        }
      }, 1000);
      function addToCart(pro_id, discount_pr) {
    
    var p_id = '';
    var p_name = '';
    var mrp = '';
    var discounted_price = '';
    var Quantity = '';
    var total_item_in_cart = '';
    var cart_value = '';

   
      fetch('/api/storefront/carts?productId=' + pro_id, {
        'credentials': 'include',
        'headers': {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        }
      }).then(function (response) {
        response.json().then(function (data) {
          if (data) {
            cart_value = data[0].cartAmount;
            var getquantity = data[0]['lineItems']['physicalItems'];
            getquantity.forEach(function (value, key) {
              if (value.productId == pro_id) {
                Quantity = value.quantity;
              }
              if (total_item_in_cart == '') {
                total_item_in_cart = value.quantity;
              } else {
                total_item_in_cart = total_item_in_cart + value.quantity;
              }

            })
          }



          var query = `query productById{
                       site {
                         product(entityId: ` + pro_id + `) {
                           id
                           entityId
                           name
                           categories
                           {
                           edges
                             {
                               node
                               {
                                 id
                                 name
                                 
                               }
                             } 
                           }
                           prices (includeTax:true){
                             price {
                               ...MoneyFields
                             }
                             
                             salePrice {
                               ...MoneyFields
                             }
                             retailPrice {
                               ...MoneyFields
                             }
                            
                           }
                         }
                       }
                     }
   
                     fragment MoneyFields on Money {
                       value
                       currencyCode
                     }`;
          axios({
            url: '/graphql',
            method: 'post',
            contentType: "application/json",
            headers: {
              'Authorization': 'Bearer {{ settings.storefront_api.token }}'
            },
            data: {
              query: query
            }
          }).then((result) => {
            var alldata = result.data.data.site.product;

            if (alldata != null) {
              p_id = alldata.entityId;

              p_name = alldata.name;
              if (alldata.prices.retailPrice != null) {
                mrp = alldata.prices.retailPrice.value;
              }
              if (alldata.prices.salePrice != null) {
                discounted_price = alldata.prices.salePrice.value;
              } else {
                discounted_price = 0;
              }

              var category = alldata.categories.edges;
              var category_ID = [];
              var category_NAME = [];
              category.forEach(function (value, index) {
                category_ID.push(value.node.id);
                category_NAME.push(value.node.name);

              })
              var categories = {
                category_ID,
                category_NAME
              };
              var category_id = '';
              var category_name = '';
              category.forEach(function (value, index) {
                if (category_id == '' && category_name == '') {
                  var cat_id = value.node.id;
                  var splited_url = atob(cat_id);
                  var categoryid = splited_url.split("Category:");
                  category_id = categoryid[1];
                  category_name = value.node.name
                } else {
                  var splited_url = atob(value.node.id);
                  var categoryid = splited_url.split("Category:");
                  var catid = categoryid[1];
                  category_id = category_id + ',' + catid;
                  category_name = category_name + ',' + value.node.name;
                }

              })

              webengage.track("add to cart", {
                  "Product_ID": p_id,
                  "Product_Name": p_name,
                  "Category_ID": category_id,
                  "Category_Name": category_name,
                  "MRP": mrp,
                  "Discount": discount_pr,
                  "Discount_Price": discounted_price,
                  "Quantity": Quantity,
                  "Total_Item_in_cart": total_item_in_cart,
                  "Cart_value": cart_value
              });
              var productObject = {
                "Product_ID": p_id,
                "Product_Name": p_name,
                "categories": categories,
                "price": mrp,
                "salePrice": discounted_price,
                "Quantity": Quantity
              };

              dataLayer.push({
                ecommerce: null
              }); // Clear the previous ecommerce object.
              dataLayer.push({
                'event': 'addToCart',
                'ecommerce': {
                  'currencyCode': 'INR',
                  'add': { // 'add' actionFieldObject measures.
                    'products': [{ //  adding a product to a shopping cart.
                      'name': p_name,
                      'id': p_id,
                      'price': discounted_price,
                      'brand': 'Kapiva',
                      'quantity': Quantity
                    }]
                  }
                }
              });
              window.dataLayer = window.dataLayer || [];
              window.dataLayer.push({
                addToCartProduct: productObject
              });

               fbq('track', 'AddToCart', {
               content_ids: p_id,
               content_type: 'product',
               value: discounted_price,
               currency: 'INR',
                quantity: Quantity
              });

            }
          });
        });
      });
    
  }
  function buyNow(pro_id, discount_pr) {
          var p_id = '';
          var p_name = '';
          var mrp = '';
          var discounted_price = '';
          var Quantity = '';
          var total_item_in_cart = '';
          var cart_value = '';
         
            fetch('/api/storefront/carts?productId=' + pro_id, {
              'credentials': 'include',
              'headers': {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
              }
            }).then(function (response) {
              response.json().then(function (data) {
                if (data) {
    
                  cart_value = data[0].cartAmount;
                  var getquantity = data[0]['lineItems']['physicalItems'];
                  getquantity.forEach(function (value, index) {
                    if (value.productId == pro_id) {
                      Quantity = value.quantity;
                    }
                    if (total_item_in_cart == '') {
                      total_item_in_cart = value.quantity;
                    } else {
                      total_item_in_cart = total_item_in_cart + value.quantity;
                    }
    
                  })
                }
                var query = `query productById{
                        site {
                          product(entityId: ` + pro_id + `) {
                            id
                            entityId
                            name
                            categories
                            {
                            edges
                              {
                                node
                                {
                                  id
                                  name
                                  
                                }
                              } 
                            }
                            prices (includeTax:true){
                              price {
                                ...MoneyFields
                              }
                              salePrice {
                                ...MoneyFields
                              }
                              retailPrice {
                                ...MoneyFields
                              }
                            }
                          }
                        }
                      }
    
                      fragment MoneyFields on Money {
                        value
                        currencyCode
                      }`;
                axios({
                  url: '/graphql',
                  method: 'post',
                  contentType: "application/json",
                  headers: {
                    'Authorization': 'Bearer {{ settings.storefront_api.token }}'
                  },
                  data: {
                    query: query
                  }
                }).then((result) => {
                  var alldata = result.data.data.site.product;
                  if (alldata != null) {
                    p_id = alldata.entityId;
    
                    p_name = alldata.name;
                    if (alldata.prices.retailPrice != null) {
                      mrp = alldata.prices.retailPrice.value;
                    }
                    if (alldata.prices.salePrice != null) {
                      discounted_price = alldata.prices.salePrice.value;
                    } else {
                      discounted_price = 0;
                    }
    
                    var category = alldata.categories.edges;
                    var category_ID = [];
                    var category_NAME = [];
                    category.forEach(function (value, index) {
    
                      category_ID.push(value.node.id);
                      category_NAME.push(value.node.name);
    
                    })
                    var categories = {
                      category_ID,
                      category_NAME
                    };
                    var category_id = '';
                    var category_name = '';
                    category.forEach(function (value, index) {
                      if (category_id == '' && category_name == '') {
                        var cat_id = value.node.id;
                        var splited_url = atob(cat_id);
                        var categoryid = splited_url.split("Category:");
                        category_id = categoryid[1];
                        category_name = value.node.name
                      } else {
                        var splited_url = atob(value.node.id);
                        var categoryid = splited_url.split("Category:");
                        var catid = categoryid[1];
                        category_id = category_id + ',' + catid;
                        category_name = category_name + ',' + value.node.name;
                      }
    
                    })
                   
                    webengage.track("buy now", {
                      "Product_ID": p_id,
                      "Product_Name": p_name,
                      "Category_ID": category_id,
                      "Category_Name": category_name,
                      "MRP": mrp,
                      "Discount": discount_pr,
                      "Discount_Price": discounted_price,
                      "Quantity": Quantity,
                      "Total_Item_in_cart": total_item_in_cart,
                      "Cart_value": cart_value
                    });
                  
                    var productObject = {
                      "Product_ID": p_id,
                      "Product_Name": p_name,
                      "categories": categories,
                      "price": mrp,
                      "salePrice": discounted_price,
                      "Quantity": Quantity
                    };
    
                    dataLayer.push({
                      ecommerce: null
                    }); // Clear the previous ecommerce object.
                    dataLayer.push({
                      'event': 'buyNow',
                      'ecommerce': {
                        'currencyCode': 'INR',
                        'add': { // 'add' actionFieldObject measures.
                          'products': [{ //  adding a product to a shopping cart.
                            'name': p_name,
                            'id': p_id,
                            'price': discounted_price,
                            'brand': 'Kapiva',
                            'quantity': Quantity
                          }]
                        }
                      }
                    });
                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                      buyNowProduct: productObject
                    });
                    fbq('track', 'buyNow', {
                      content_ids: p_id,
                      content_type: 'product',
                      value: discounted_price,
                      currency: 'INR',
                      quantity: Quantity
                    });
                    window.location.href = '/checkout';
                  }
                });
              });
            });
        
        }
</script>
